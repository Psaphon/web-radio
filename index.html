<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Radio - Secure Music Player</title>
    
    <!-- Strict Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' https://unpkg.com https://cdnjs.cloudflare.com 'unsafe-inline';
        style-src 'self' 'unsafe-inline';
        img-src 'self' data: https:;
        media-src 'self' https:;
        connect-src 'self' https:;
        font-src 'self';
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    ">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒŠ</text></svg>">
    
    <!-- Production React to avoid eval issues -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #001122 0%, #003366 50%, #004488 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .ocean-radio {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        
        .title {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(45deg, #00d4ff, #0099cc, #006699);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .album-art {
            width: 200px;
            height: 200px;
            border-radius: 16px;
            background: linear-gradient(45deg, #006699, #0099cc, #00d4ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            margin: 0 auto 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .track-info {
            margin: 20px 0;
        }
        
        .track-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .track-artist {
            font-size: 18px;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        .btn:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .play-btn {
            width: 80px;
            height: 80px;
            font-size: 28px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #0099cc);
            transition: width 0.1s ease;
        }
        
        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            opacity: 0.7;
        }
        
        .status-message {
            margin: 15px 0;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .status-error {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.4);
        }
        
        .status-info {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
        }
        
        .track-selector {
            margin: 20px 0;
        }
        
        .track-list {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .track-item {
            padding: 8px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .track-item:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .track-item.active {
            background: rgba(0, 212, 255, 0.3);
            border-color: rgba(0, 212, 255, 0.5);
        }
        
        .volume-control {
            margin: 20px 0;
        }
        
        .volume-slider {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #00d4ff;
            cursor: pointer;
        }
        
        @media (max-width: 600px) {
            .ocean-radio {
                padding: 20px;
            }
            
            .title {
                font-size: 28px;
            }
            
            .album-art {
                width: 150px;
                height: 150px;
                font-size: 48px;
            }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <video style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: -1; opacity: 0.3;" 
           autoplay muted loop>
        <source src="./fishswimming.mp4" type="video/mp4">
    </video>

    <div id="app"></div>

    <script>
        const { useState, useEffect, useRef, createElement: e } = React;
        
        const OceanRadio = () => {
            const [currentTrack, setCurrentTrack] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [volume, setVolume] = useState(70);
            const [currentTime, setCurrentTime] = useState(0);
            const [duration, setDuration] = useState(0);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [errorCount, setErrorCount] = useState(0);
            const [isBlocked, setIsBlocked] = useState(false);
            
            const audioRef = useRef(null);
            
            // Curated, safe audio sources
            const tracks = [
                {
                    title: "Ocean Waves",
                    artist: "Nature Sounds",
                    artwork: "ðŸŒŠ",
                    // Using reliable, safe audio sources
                    audioUrl: "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav"
                },
                {
                    title: "Gentle Rain", 
                    artist: "Ambient Collective",
                    artwork: "ðŸŒ§ï¸",
                    audioUrl: "https://sample-videos.com/zip/10/wav/wav-sample-1.wav"
                },
                {
                    title: "Forest Birds",
                    artist: "Wildlife Sounds", 
                    artwork: "ðŸ¦",
                    audioUrl: "https://www.soundjay.com/misc/sounds/clock-ticking-3.wav"
                }
            ];

            const currentTrackData = tracks[currentTrack];

            // Reset error blocking after some time
            useEffect(() => {
                if (isBlocked) {
                    const timer = setTimeout(() => {
                        setIsBlocked(false);
                        setErrorCount(0);
                        setError("Playback unblocked. You can try again.");
                    }, 30000); // 30 seconds
                    
                    return () => clearTimeout(timer);
                }
            }, [isBlocked]);

            // Audio event handlers with smart error handling
            useEffect(() => {
                const audio = audioRef.current;
                if (!audio) return;

                const updateTime = () => setCurrentTime(audio.currentTime);
                const updateDuration = () => setDuration(audio.duration || 0);
                
                const handleLoadStart = () => {
                    setLoading(true);
                    setError(null);
                };
                
                const handleCanPlay = () => {
                    setLoading(false);
                };
                
                const handleError = (e) => {
                    console.error('Audio error:', e.target.error);
                    setLoading(false);
                    setIsPlaying(false);
                    
                    const newErrorCount = errorCount + 1;
                    setErrorCount(newErrorCount);
                    
                    if (newErrorCount >= 3) {
                        setIsBlocked(true);
                        setError("Too many errors. Playback blocked for 30 seconds to prevent issues.");
                    } else {
                        setError(`Audio failed to load (${newErrorCount}/3). Try a different track.`);
                    }
                };

                const handleEnded = () => {
                    setIsPlaying(false);
                    setCurrentTime(0);
                    // NO auto-advance - user must manually select next track
                };

                audio.addEventListener('timeupdate', updateTime);
                audio.addEventListener('loadedmetadata', updateDuration);
                audio.addEventListener('loadstart', handleLoadStart);
                audio.addEventListener('canplay', handleCanPlay);
                audio.addEventListener('error', handleError);
                audio.addEventListener('ended', handleEnded);

                return () => {
                    audio.removeEventListener('timeupdate', updateTime);
                    audio.removeEventListener('loadedmetadata', updateDuration);
                    audio.removeEventListener('loadstart', handleLoadStart);
                    audio.removeEventListener('canplay', handleCanPlay);
                    audio.removeEventListener('error', handleError);
                    audio.removeEventListener('ended', handleEnded);
                };
            }, [currentTrack, errorCount]);

            // Apply volume changes
            useEffect(() => {
                const audio = audioRef.current;
                if (audio) {
                    audio.volume = volume / 100;
                }
            }, [volume]);

            const togglePlay = async () => {
                if (isBlocked) {
                    setError("Playback is blocked due to errors. Please wait.");
                    return;
                }

                const audio = audioRef.current;
                if (!audio) return;

                try {
                    if (isPlaying) {
                        await audio.pause();
                        setIsPlaying(false);
                    } else {
                        await audio.play();
                        setIsPlaying(true);
                        setError(null);
                        // Reset error count on successful play
                        if (errorCount > 0) {
                            setErrorCount(0);
                        }
                    }
                } catch (error) {
                    console.error('Playback error:', error);
                    setIsPlaying(false);
                    setError('Playback failed. This might be due to browser autoplay restrictions.');
                }
            };

            const selectTrack = (trackIndex) => {
                if (isBlocked) {
                    setError("Track switching blocked due to errors. Please wait.");
                    return;
                }
                
                setCurrentTrack(trackIndex);
                setIsPlaying(false);
                setCurrentTime(0);
                setError(null);
            };

            const formatTime = (time) => {
                if (!time || isNaN(time)) return '0:00';
                const minutes = Math.floor(time / 60);
                const seconds = Math.floor(time % 60);
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            };

            return e('div', { className: 'ocean-radio' }, [
                e('h1', { key: 'title', className: 'title' }, 'ðŸŒŠ Ocean Radio'),
                e('p', { key: 'subtitle', className: 'subtitle' }, 'Secure Music Player'),
                
                e('div', { key: 'album', className: 'album-art' }, currentTrackData.artwork),
                
                e('div', { key: 'info', className: 'track-info' }, [
                    e('div', { key: 'title', className: 'track-title' }, currentTrackData.title),
                    e('div', { key: 'artist', className: 'track-artist' }, currentTrackData.artist)
                ]),

                error && e('div', { 
                    key: 'error', 
                    className: `status-message ${error.includes('blocked') || error.includes('Too many') ? 'status-error' : 'status-info'}` 
                }, error),

                e('div', { key: 'controls', className: 'controls' }, [
                    e('button', {
                        key: 'prev',
                        className: 'btn control-btn',
                        onClick: () => selectTrack(currentTrack > 0 ? currentTrack - 1 : tracks.length - 1),
                        disabled: isBlocked
                    }, 'â®ï¸'),
                    
                    e('button', {
                        key: 'play',
                        className: 'btn play-btn',
                        onClick: togglePlay,
                        disabled: loading || isBlocked
                    }, loading ? 'â³' : (isPlaying ? 'â¸ï¸' : 'â–¶ï¸')),
                    
                    e('button', {
                        key: 'next',
                        className: 'btn control-btn',
                        onClick: () => selectTrack((currentTrack + 1) % tracks.length),
                        disabled: isBlocked
                    }, 'â­ï¸')
                ]),

                e('div', { key: 'progress', className: 'progress-container' }, [
                    e('div', { key: 'bar', className: 'progress-bar' },
                        e('div', {
                            className: 'progress-fill',
                            style: { width: `${duration ? (currentTime / duration * 100) : 0}%` }
                        })
                    ),
                    e('div', { key: 'time', className: 'time-display' }, [
                        e('span', { key: 'current' }, formatTime(currentTime)),
                        e('span', { key: 'total' }, formatTime(duration))
                    ])
                ]),

                e('div', { key: 'selector', className: 'track-selector' }, [
                    e('div', { key: 'list', className: 'track-list' }, 
                        tracks.map((track, index) => 
                            e('div', {
                                key: index,
                                className: `track-item ${index === currentTrack ? 'active' : ''}`,
                                onClick: () => selectTrack(index)
                            }, `${track.artwork} ${track.title}`)
                        )
                    )
                ]),

                e('div', { key: 'volume', className: 'volume-control' }, [
                    e('label', { key: 'label', style: { fontSize: '14px', marginBottom: '8px', display: 'block' } }, 
                        `ðŸ”Š Volume: ${volume}%`),
                    e('input', {
                        key: 'slider',
                        type: 'range',
                        className: 'volume-slider',
                        min: 0,
                        max: 100,
                        value: volume,
                        onChange: (e) => setVolume(parseInt(e.target.value))
                    })
                ]),

                e('audio', {
                    key: 'audio',
                    ref: audioRef,
                    src: currentTrackData.audioUrl,
                    preload: 'metadata'
                })
            ]);
        };

        ReactDOM.render(React.createElement(OceanRadio), document.getElementById('app'));
    </script>
</body>
</html>
