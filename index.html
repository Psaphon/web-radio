<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean Radio - Live Ocean Health Experience</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🌊</text></svg>">
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
        }
        
        /* Full-screen ocean video background */
        .ocean-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -1;
        }
        
        .ocean-video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Fallback animated background if no video */
        .ocean-fallback {
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                #001122 0%,
                #003366 25%,
                #004488 50%,
                #0066aa 75%,
                #003366 100%
            );
            background-size: 400% 400%;
            animation: oceanWave 15s ease-in-out infinite;
        }
        
        @keyframes oceanWave {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }
        
        /* Gradient overlay for readability */
        .ocean-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(
                180deg,
                rgba(0, 20, 40, 0.2) 0%,
                rgba(0, 50, 100, 0.3) 50%,
                rgba(0, 30, 60, 0.5) 100%
            );
            z-index: 1;
        }
        
        /* Main app container */
        .app {
            position: relative;
            z-index: 10;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header with ocean health status */
        .ocean-status {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 50, 100, 0.3);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .status-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .app-title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .pulse-dot {
            width: 10px;
            height: 10px;
            background: #ff4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .ocean-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }
        
        .metric {
            text-align: center;
        }
        
        .metric-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .metric-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .metric-good { color: #4ade80; }
        .metric-warning { color: #fbbf24; }
        .metric-critical { color: #f87171; }
        
        /* Music player at bottom */
        .music-player {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(0, 30, 60, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .player-content {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .album-art {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            background: linear-gradient(45deg, #006699, #00d4ff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .track-info {
            flex: 1;
            min-width: 200px;
        }
        
        .track-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .track-subtitle {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .player-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .play-btn {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }
        
        /* Audio effects indicator */
        .audio-effects {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(0, 30, 60, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            min-width: 120px;
        }
        
        .effects-title {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 10px;
        }
        
        .effect-visualization {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 212, 255, 0.3), transparent);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: visualize 3s ease-in-out infinite;
        }
        
        @keyframes visualize {
            0%, 100% { transform: scale(1) rotate(0deg); opacity: 0.8; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 1; }
        }
        
        .distortion-level {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .health-status {
            font-size: 10px;
            opacity: 0.7;
        }
        
        .error-message {
            background: rgba(255, 100, 100, 0.2);
            border: 1px solid rgba(255, 100, 100, 0.4);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        .info-message {
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.4);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .ocean-status, .music-player {
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            .audio-effects {
                position: static;
                transform: none;
                margin: 10px;
                width: calc(100% - 20px);
            }
            
            .status-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .app-title {
                font-size: 20px;
            }
            
            .player-content {
                gap: 15px;
            }
            
            .album-art {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
            
            .ocean-metrics {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Ocean Video Background -->
    <div class="ocean-background">
        <!-- Try to use your local video first -->
        <video class="ocean-video" autoplay muted loop id="oceanVideo">
            <source src="./fishswimming.mp4" type="video/mp4">
        </video>
        
        <!-- Animated fallback background -->
        <div class="ocean-fallback" id="oceanFallback" style="display: none;"></div>
    </div>
    
    <div class="ocean-overlay"></div>

    <div id="app"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        const OceanRadio = () => {
            // Ocean health data state
            const [oceanData, setOceanData] = useState({
                temperature: 22.1,
                pH: 8.1,
                oxygen: 87,
                pollution: 23,
                location: "Miami Coral Reef"
            });
            
            // Music player state
            const [currentTrack, setCurrentTrack] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [audioContext, setAudioContext] = useState(null);
            const [error, setError] = useState(null);
            const [loading, setLoading] = useState(false);
            const [audioEffects, setAudioEffects] = useState({
                distortion: 0.2,
                reverb: 0.3,
                speed: 1.0
            });
            
            const audioRef = useRef(null);
            const gainNodeRef = useRef(null);
            
            // Real music tracks - you'll replace these URLs with actual music
            const tracks = [
                {
                    title: "Ocean Currents",
                    artist: "Environmental Audio",
                    artwork: "🌊",
                    url: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3"
                },
                {
                    title: "Coral Garden",
                    artist: "Marine Sounds",
                    artwork: "🐠",
                    url: "https://sample-music.netlify.app/death%20bed.mp3"
                },
                {
                    title: "Deep Blue",
                    artist: "Ocean Symphony",
                    artwork: "🌀",
                    url: "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav"
                }
            ];
            
            const currentTrackData = tracks[currentTrack];
            
            // Check if video loads, show fallback if not
            useEffect(() => {
                const video = document.getElementById('oceanVideo');
                const fallback = document.getElementById('oceanFallback');
                
                if (video) {
                    video.onerror = () => {
                        console.log('Video failed to load, showing animated fallback');
                        video.style.display = 'none';
                        if (fallback) fallback.style.display = 'block';
                    };
                    
                    video.onloadstart = () => {
                        console.log('Video started loading');
                    };
                    
                    video.oncanplay = () => {
                        console.log('Video ready to play');
                        if (fallback) fallback.style.display = 'none';
                    };
                }
            }, []);
            
            // Simulate real ocean data updates
            useEffect(() => {
                const updateOceanData = () => {
                    setOceanData(prev => {
                        // Simulate realistic ocean sensor readings
                        const tempVariation = (Math.random() - 0.5) * 0.5; // ±0.25°C change
                        const pHVariation = (Math.random() - 0.5) * 0.02; // ±0.01 pH change
                        const oxygenVariation = (Math.random() - 0.5) * 2; // ±1% change
                        const pollutionVariation = (Math.random() - 0.5) * 1; // ±0.5% change
                        
                        return {
                            temperature: Math.max(18, Math.min(30, prev.temperature + tempVariation)),
                            pH: Math.max(7.5, Math.min(8.5, prev.pH + pHVariation)),
                            oxygen: Math.max(60, Math.min(100, prev.oxygen + oxygenVariation)),
                            pollution: Math.max(0, Math.min(50, prev.pollution + pollutionVariation)),
                            location: prev.location
                        };
                    });
                };
                
                // Update every 15 seconds to simulate real sensor data
                const interval = setInterval(updateOceanData, 15000);
                updateOceanData(); // Initial update
                
                return () => clearInterval(interval);
            }, []);
            
            // Update audio effects based on ocean health
            useEffect(() => {
                const healthScore = calculateOceanHealth(oceanData);
                
                setAudioEffects(prev => ({
                    distortion: (100 - healthScore) / 200, // 0-0.5 range
                    reverb: oceanData.temperature > 25 ? 0.6 : 0.2,
                    speed: 0.85 + (healthScore / 200) // 0.85-1.35 range
                }));
            }, [oceanData]);
            
            // Apply audio effects to playback
            useEffect(() => {
                if (audioRef.current) {
                    try {
                        audioRef.current.playbackRate = audioEffects.speed;
                        
                        if (gainNodeRef.current) {
                            const healthScore = calculateOceanHealth(oceanData);
                            gainNodeRef.current.gain.value = 0.3 + (healthScore / 200);
                        }
                    } catch (error) {
                        console.warn('Audio effects error:', error);
                    }
                }
            }, [audioEffects, oceanData]);
            
            const calculateOceanHealth = (data) => {
                // Calculate health score (0-100) based on ideal ranges
                let score = 0;
                
                // Temperature: ideal 20-26°C
                if (data.temperature >= 20 && data.temperature <= 26) score += 25;
                else if (data.temperature >= 18 && data.temperature <= 28) score += 15;
                else score += 5;
                
                // pH: ideal 8.0-8.3
                if (data.pH >= 8.0 && data.pH <= 8.3) score += 25;
                else if (data.pH >= 7.8 && data.pH <= 8.4) score += 15;
                else score += 5;
                
                // Oxygen: higher is better
                score += Math.min(25, data.oxygen * 0.25);
                
                // Pollution: lower is better
                score += Math.max(0, 25 - data.pollution * 0.5);
                
                return Math.round(Math.max(0, Math.min(100, score)));
            };
            
            const getMetricStatus = (value, type) => {
                switch(type) {
                    case 'temperature':
                        if (value >= 20 && value <= 26) return 'good';
                        if (value >= 18 && value <= 28) return 'warning';
                        return 'critical';
                    case 'pH':
                        if (value >= 8.0 && value <= 8.3) return 'good';
                        if (value >= 7.8 && value <= 8.4) return 'warning';
                        return 'critical';
                    case 'oxygen':
                        if (value >= 85) return 'good';
                        if (value >= 70) return 'warning';
                        return 'critical';
                    case 'pollution':
                        if (value <= 15) return 'good';
                        if (value <= 30) return 'warning';
                        return 'critical';
                    default:
                        return 'good';
                }
            };
            
            const initAudioContext = async () => {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    setAudioContext(ctx);
                    
                    if (audioRef.current && ctx.state === 'suspended') {
                        await ctx.resume();
                    }
                    
                    if (audioRef.current) {
                        const source = ctx.createMediaElementSource(audioRef.current);
                        const gainNode = ctx.createGain();
                        gainNodeRef.current = gainNode;
                        
                        source.connect(gainNode);
                        gainNode.connect(ctx.destination);
                    }
                } catch (error) {
                    console.error('Audio context error:', error);
                    setError('Audio system initialization failed');
                }
            };
            
            const togglePlay = async () => {
                try {
                    setError(null);
                    
                    if (!audioContext) {
                        await initAudioContext();
                    }
                    
                    if (audioRef.current) {
                        if (isPlaying) {
                            await audioRef.current.pause();
                            setIsPlaying(false);
                        } else {
                            setLoading(true);
                            await audioRef.current.play();
                            setIsPlaying(true);
                            setLoading(false);
                        }
                    }
                } catch (error) {
                    console.error('Playback error:', error);
                    setLoading(false);
                    setError('Playback failed - try clicking play again');
                }
            };
            
            const nextTrack = () => {
                setCurrentTrack((prev) => (prev + 1) % tracks.length);
                setIsPlaying(false);
            };
            
            const prevTrack = () => {
                setCurrentTrack((prev) => (prev - 1 + tracks.length) % tracks.length);
                setIsPlaying(false);
            };
            
            const healthScore = calculateOceanHealth(oceanData);
            const distortionLevel = Math.round(audioEffects.distortion * 100);
            
            return (
                <div className="app">
                    {/* Ocean Health Status */}
                    <div className="ocean-status">
                        <div className="status-header">
                            <h1 className="app-title">🌊 Ocean Radio</h1>
                            <div className="live-indicator">
                                <div className="pulse-dot"></div>
                                <span>LIVE from {oceanData.location}</span>
                            </div>
                        </div>
                        
                        {error && (
                            <div className="error-message">
                                ⚠️ {error}
                            </div>
                        )}
                        
                        <div className="ocean-metrics">
                            <div className="metric">
                                <div className="metric-label">Temperature</div>
                                <div className={`metric-value metric-${getMetricStatus(oceanData.temperature, 'temperature')}`}>
                                    {oceanData.temperature.toFixed(1)}°C
                                </div>
                            </div>
                            
                            <div className="metric">
                                <div className="metric-label">pH Level</div>
                                <div className={`metric-value metric-${getMetricStatus(oceanData.pH, 'pH')}`}>
                                    {oceanData.pH.toFixed(2)}
                                </div>
                            </div>
                            
                            <div className="metric">
                                <div className="metric-label">Oxygen</div>
                                <div className={`metric-value metric-${getMetricStatus(oceanData.oxygen, 'oxygen')}`}>
                                    {Math.round(oceanData.oxygen)}%
                                </div>
                            </div>
                            
                            <div className="metric">
                                <div className="metric-label">Pollution</div>
                                <div className={`metric-value metric-${getMetricStatus(oceanData.pollution, 'pollution')}`}>
                                    {Math.round(oceanData.pollution)}%
                                </div>
                            </div>
                            
                            <div className="metric">
                                <div className="metric-label">Health Score</div>
                                <div className={`metric-value metric-${healthScore >= 80 ? 'good' : healthScore >= 60 ? 'warning' : 'critical'}`}>
                                    {healthScore}%
                                </div>
                            </div>
                        </div>
                        
                        {healthScore < 70 && (
                            <div className="info-message">
                                🌊 Ocean health is affecting the music distortion. Lower health = more audio effects.
                            </div>
                        )}
                    </div>
                    
                    {/* Audio Effects Visualization */}
                    <div className="audio-effects">
                        <div className="effects-title">Audio Effects</div>
                        <div className="effect-visualization">
                            🎵
                        </div>
                        <div className="distortion-level">
                            {distortionLevel}% distorted
                        </div>
                        <div className="health-status">
                            Speed: {(audioEffects.speed * 100).toFixed(0)}%
                        </div>
                    </div>
                    
                    {/* Music Player */}
                    <div className="music-player">
                        <div className="player-content">
                            <div className="album-art">
                                {currentTrackData.artwork}
                            </div>
                            
                            <div className="track-info">
                                <div className="track-title">{currentTrackData.title}</div>
                                <div className="track-subtitle">{currentTrackData.artist}</div>
                            </div>
                            
                            <div className="player-controls">
                                <button className="control-btn" onClick={prevTrack}>
                                    ⏮️
                                </button>
                                <button 
                                    className="control-btn play-btn" 
                                    onClick={togglePlay}
                                    disabled={loading}
                                >
                                    {loading ? '⏳' : (isPlaying ? '⏸️' : '▶️')}
                                </button>
                                <button className="control-btn" onClick={nextTrack}>
                                    ⏭️
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    {/* Audio element */}
                    <audio 
                        ref={audioRef}
                        src={currentTrackData.url}
                        crossOrigin="anonymous"
                        onError={() => setError(`Failed to load: ${currentTrackData.title}`)}
                        onLoadStart={() => setLoading(true)}
                        onCanPlay={() => setLoading(false)}
                    />
                </div>
            );
        };
        
        ReactDOM.render(<OceanRadio />, document.getElementById('app'));
    </script>
</body>
</html>
